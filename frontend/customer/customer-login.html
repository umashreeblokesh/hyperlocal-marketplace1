<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Customer Login | Hyperlocal Mart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link rel="stylesheet" href="../css/style.css" />
</head>
<body class="bg-dark">
<div class="page-wrapper page-fade">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-5">
        <div class="card-elevated p-4">

          <h3 class="mb-1 text-center">Customer Login</h3>
          <p class="text-helper text-center mb-3">
            Login to see nearby verified shops (within 1‚Äì3 km).
          </p>

          <form action="../../backend/customer/login_customer.php" method="POST">
            <!-- Email -->
            <div class="mb-3">
              <label class="form-label">Email</label>
              <input type="email" name="email" class="form-control" required>
            </div>

            <!-- Password -->
            <div class="mb-3">
              <label class="form-label">Password</label>
              <div class="password-wrapper">
                <input type="password" name="password" class="form-control" required>
                <span class="toggle-password">üëÅÔ∏è</span>
              </div>
            </div>

            <!-- hidden fields for location -->
            <input type="hidden" name="latitude" id="login-lat">
            <input type="hidden" name="longitude" id="login-lng">
            <input type="hidden" name="login_location" id="login-location">

            <!-- THIS BUTTON SHOULD APPEAR -->
            <div class="mb-2">
              <button type="button"
                      class="btn btn-outline-primary w-100"
                      onclick="detectLoginLocation()">
                üìç Use my current location (recommended)
              </button>
              <p class="text-helper mt-1 mb-0">
                This helps us show shops only within 1‚Äì3 km from you.
              </p>
            </div>

            <button type="submit" class="btn btn-success w-100 mt-2">
              Login
            </button>

            <p class="text-helper text-center mt-3 mb-0">
              New customer?
              <a href="customer-signup.html" class="text-decoration-none">Create account</a>
            </p>
          </form>

        </div>
      </div>
    </div>
  </div>
</div>

<script>
function detectLoginLocation() {
  if (!navigator.geolocation) {
    alert("Your browser does not support location.");
    return;
  }

  navigator.geolocation.getCurrentPosition(
    function (pos) {
      const lat = pos.coords.latitude;
      const lng = pos.coords.longitude;

      document.getElementById("login-lat").value = lat;
      document.getElementById("login-lng").value = lng;
      document.getElementById("login-location").value =
        lat.toFixed(5) + ", " + lng.toFixed(5);

      alert("‚úÖ Location captured. Now click Login.");
    },
    function (err) {
      if (err.code === 1) {
        alert("‚ùå Permission denied. Please allow location.");
      } else {
        alert("‚ùå Unable to get location.");
      }
    }
  );
}
</script>

<script src="../js/toggle-password.js"></script>
</body>
</html>
