<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Vendor Signup | Hyperlocal Mart</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Bootstrap -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <!-- Global CSS -->
  <link rel="stylesheet" href="../css/style.css" />

  <!-- Leaflet -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    .map-wrapper { position: relative; margin-top: 6px; }
    #vendor-map {
      width: 100%;
      height: 220px;
      border-radius: 14px;
      border: 1px solid rgba(148,163,184,0.6);
    }
    .map-search {
      position: absolute;
      top: 8px;
      left: 50%;
      transform: translateX(-50%);
      width: 80%;
      z-index: 1000;
    }
  </style>
</head>

<body class="bg-dark">
<div class="page-wrapper page-fade">
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-md-6">

        <!-- ‚úÖ Small rectangle card -->
        <div class="card-elevated p-4">

          <h3 class="mb-1 text-center">Vendor Signup</h3>
          <p class="text-helper text-center mb-3">
            Register your shop to start selling locally.
          </p>

          <form action="../../backend/vendor/register_vendor.php" method="POST" enctype="multipart/form-data">

            <div class="mb-2">
              <label class="form-label">Owner Name</label>
              <input type="text" name="owner_name" class="form-control" required>
            </div>

            <div class="mb-2">
              <label class="form-label">Shop Name</label>
              <input type="text" name="shop_name" class="form-control" required>
            </div>

            <div class="mb-2">
              <label class="form-label">Shop Address</label>
              <textarea name="shop_address" class="form-control" required></textarea>
            </div>

            <div class="mb-2">
              <label class="form-label">Shop Type</label>
              <input type="text" name="shop_type" class="form-control" required>
            </div>

            <div class="mb-2">
              <label class="form-label">Phone</label>
              <input type="text" name="phone" class="form-control" required>
            </div>

            <div class="mb-2">
              <label class="form-label">Email</label>
              <input type="email" name="email" class="form-control" required>
            </div>

            <!-- Password -->
            <div class="mb-3">
              <label class="form-label">Password</label>
              <div class="password-wrapper">
                <input type="password" name="password" class="form-control" required>
                <span class="toggle-password">üëÅÔ∏è</span>
              </div>
            </div>

            <!-- ‚úÖ Location Field -->
            <div class="mb-2">
              <label class="form-label">Shop Location</label>

              <div class="map-wrapper">
                <div class="map-search input-group input-group-sm">
                  <input type="text" id="vendor-search" class="form-control"
                         placeholder="Search city (kolar, bangalore)">
                  <button type="button" class="btn btn-outline-primary"
                          onclick="searchVendorLocation()">üîç</button>
                </div>
                <div id="vendor-map"></div>
              </div>

              <input type="text" name="location" id="vendor-location"
                     class="form-control mt-2" placeholder="Auto-filled" required>

              <input type="hidden" name="latitude" id="vendor-lat">
              <input type="hidden" name="longitude" id="vendor-lng">

              <button type="button" class="btn btn-outline-primary w-100 mt-2"
                      onclick="useVendorCurrentLocation()">
                üìç Use My Location
              </button>
            </div>

            <!-- License -->
            <div class="mb-3">
              <label class="form-label">Shop License (PDF)</label>
              <input type="file" name="license_pdf" accept="application/pdf"
                     class="form-control" required>
            </div>

            <button type="submit" class="btn btn-success w-100 mt-2">
              Register Shop
            </button>

            <p class="text-helper text-center mt-3">
              Already a vendor?
              <a href="vendor-login.html">Login here</a>
            </p>

          </form>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Leaflet -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<script>
let vendorMap, vendorMarker;
const PRESET = {
  kolar:{lat:13.136,lng:78.129},
  bangalore:{lat:12.9716,lng:77.5946},
  bengaluru:{lat:12.9716,lng:77.5946},
  coimbatore:{lat:11.0168,lng:76.9558}
};

function initMap(){
  vendorMap = L.map('vendor-map').setView([11.0168,76.9558],13);
  L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(vendorMap);
  vendorMarker = L.marker([11.0168,76.9558]).addTo(vendorMap);

  vendorMap.on('click', e=>{
    setVendorPosition(e.latlng.lat,e.latlng.lng);
  });
}

function setVendorPosition(lat,lng){
  vendorMarker.setLatLng([lat,lng]);
  document.getElementById("vendor-lat").value=lat;
  document.getElementById("vendor-lng").value=lng;
  document.getElementById("vendor-location").value=lat.toFixed(5)+", "+lng.toFixed(5);
}

function useVendorCurrentLocation(){
  navigator.geolocation.getCurrentPosition(pos=>{
    setVendorPosition(pos.coords.latitude,pos.coords.longitude);
    alert("‚úÖ Location captured");
  });
}

function searchVendorLocation(){
  let q=document.getElementById("vendor-search").value.toLowerCase();
  if(PRESET[q]){
    setVendorPosition(PRESET[q].lat,PRESET[q].lng);
  } else {
    alert("Type: kolar, bangalore, coimbatore");
  }
}

document.addEventListener("DOMContentLoaded",initMap);
</script>

<script src="../js/toggle-password.js"></script>
</body>
</html>